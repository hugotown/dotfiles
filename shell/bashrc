# Portable config - works on Nix, NixOS, and Arch Linux
[[ $- == *i* ]] || return

HISTFILESIZE=100000
HISTSIZE=10000
shopt -s histappend checkwinsize extglob globstar

# 1. Environment (env.zsh is POSIX-compatible, works in bash)
[ -f ~/.config/shell/env.zsh ] && source ~/.config/shell/env.zsh

# 2. Tracked integrations
[ -f ~/.config/shell/integrations/zoxide.bash ] && source ~/.config/shell/integrations/zoxide.bash
[ -f ~/.config/shell/integrations/atuin.bash ] && source ~/.config/shell/integrations/atuin.bash
[ -f ~/.config/shell/integrations/yazi.bash ] && source ~/.config/shell/integrations/yazi.bash
command -v mise >/dev/null && eval "$(mise activate bash)"

# 3. Cached integrations
[ -f ~/.cache/shell/starship.bash ] && source ~/.cache/shell/starship.bash
[ -f ~/.cache/shell/direnv.bash ] && source ~/.cache/shell/direnv.bash

# 4. User customizations
alias cldy="claude --dangerously-skip-permissions"

add-secret() {
    [ "$#" -lt 2 ] && { echo "Usage: add-secret VAR_NAME value" >&2; return 1; }
    ~/.config/shell/scripts/add-secret "$1" "$2" && export "$1=$2"
}
