# Internationalization (i18n) Configuration

Next.js provides built-in internationalization (i18n) routing and locale detection. Configure i18n in `next.config.js`.

**Note**: i18n routing is for the Pages Router. For App Router, use custom i18n or libraries like `next-intl`.

## Basic Configuration

```javascript
/** @type {import('next').NextConfig} */
const nextConfig = {
  i18n: {
    locales: ['en', 'fr', 'de'],
    defaultLocale: 'en',
  },
}

module.exports = nextConfig
```

**Result:**
- Default locale: `example.com/about` (English)
- French: `example.com/fr/about`
- German: `example.com/de/about`

## i18n Configuration Options

```javascript
const nextConfig = {
  i18n: {
    // Supported locales
    locales: ['en-US', 'fr', 'nl-NL'],

    // Default locale (no prefix in URL)
    defaultLocale: 'en-US',

    // Domain-based routing (optional)
    domains: [
      {
        domain: 'example.com',
        defaultLocale: 'en-US',
      },
      {
        domain: 'example.fr',
        defaultLocale: 'fr',
      },
      {
        domain: 'example.nl',
        defaultLocale: 'nl-NL',
        // Optional: specify http for development
        http: true,
      },
    ],

    // Disable automatic locale detection
    localeDetection: true,
  },
}
```

## Locale Configuration

### Simple Locales

```javascript
const nextConfig = {
  i18n: {
    locales: ['en', 'fr', 'de', 'es'],
    defaultLocale: 'en',
  },
}
```

### Locale with Region

```javascript
const nextConfig = {
  i18n: {
    locales: ['en-US', 'en-GB', 'fr-FR', 'fr-CA'],
    defaultLocale: 'en-US',
  },
}
```

## Default Locale

The default locale is served without a prefix:

```javascript
const nextConfig = {
  i18n: {
    locales: ['en', 'fr'],
    defaultLocale: 'en',
  },
}
```

**URLs:**
- English (default): `/about`, `/blog`
- French: `/fr/about`, `/fr/blog`

## Domain-Based Routing

Route different locales to different domains:

```javascript
const nextConfig = {
  i18n: {
    locales: ['en-US', 'fr', 'de'],
    defaultLocale: 'en-US',

    domains: [
      {
        domain: 'example.com',
        defaultLocale: 'en-US',
      },
      {
        domain: 'example.fr',
        defaultLocale: 'fr',
      },
      {
        domain: 'example.de',
        defaultLocale: 'de',
      },
    ],
  },
}
```

**Result:**
- `example.com` → English
- `example.fr` → French
- `example.de` → German

### Domain with Multiple Locales

```javascript
const nextConfig = {
  i18n: {
    locales: ['en', 'fr', 'nl-BE', 'nl-NL'],
    defaultLocale: 'en',

    domains: [
      {
        domain: 'example.com',
        defaultLocale: 'en',
        locales: ['en'],
      },
      {
        domain: 'example.fr',
        defaultLocale: 'fr',
        locales: ['fr'],
      },
      {
        domain: 'example.be',
        defaultLocale: 'nl-BE',
        locales: ['nl-BE', 'fr'],
      },
      {
        domain: 'example.nl',
        defaultLocale: 'nl-NL',
        locales: ['nl-NL'],
      },
    ],
  },
}
```

## Locale Detection

Next.js automatically detects user locale based on:
1. Locale prefix in URL
2. `Accept-Language` header
3. Cookie (`NEXT_LOCALE`)

### Enable/Disable Detection

```javascript
const nextConfig = {
  i18n: {
    locales: ['en', 'fr'],
    defaultLocale: 'en',
    localeDetection: true, // Default: true
  },
}
```

### Custom Locale Detection

```typescript
// middleware.ts
import { NextRequest, NextResponse } from 'next/server'

export function middleware(request: NextRequest) {
  const locale = request.cookies.get('CUSTOM_LOCALE')?.value || 'en'

  if (!request.nextUrl.pathname.startsWith(`/${locale}`)) {
    return NextResponse.redirect(
      new URL(`/${locale}${request.nextUrl.pathname}`, request.url)
    )
  }
}
```

## Accessing Locale in Code

### In Pages (Pages Router)

```typescript
import { useRouter } from 'next/router'

export default function Page() {
  const router = useRouter()
  const { locale, locales, defaultLocale } = router

  return (
    <div>
      <p>Current locale: {locale}</p>
      <p>Available locales: {locales?.join(', ')}</p>
      <p>Default locale: {defaultLocale}</p>
    </div>
  )
}
```

### Switching Locales

```typescript
import { useRouter } from 'next/router'
import Link from 'next/link'

export default function LocaleSwitcher() {
  const router = useRouter()
  const { locales, locale: activeLocale } = router

  return (
    <div>
      {locales?.map((locale) => (
        <Link
          key={locale}
          href={router.asPath}
          locale={locale}
          className={locale === activeLocale ? 'active' : ''}
        >
          {locale}
        </Link>
      ))}
    </div>
  )
}
```

### Programmatic Navigation

```typescript
import { useRouter } from 'next/router'

export default function Component() {
  const router = useRouter()

  const switchToFrench = () => {
    router.push(router.asPath, router.asPath, { locale: 'fr' })
  }

  return (
    <button onClick={switchToFrench}>
      Switch to French
    </button>
  )
}
```

## getStaticProps with i18n

```typescript
import { GetStaticProps } from 'next'

export const getStaticProps: GetStaticProps = async ({ locale }) => {
  const translations = await import(`../locales/${locale}.json`)

  return {
    props: {
      translations: translations.default,
    },
  }
}

export default function Page({ translations }) {
  return <div>{translations.welcome}</div>
}
```

## getServerSideProps with i18n

```typescript
import { GetServerSideProps } from 'next'

export const getServerSideProps: GetServerSideProps = async ({ locale }) => {
  const data = await fetchData(locale)

  return {
    props: {
      data,
      locale,
    },
  }
}
```

## Dynamic Routes with i18n

### getStaticPaths

```typescript
export async function getStaticPaths({ locales }) {
  const posts = await getPosts()

  const paths = []
  locales.forEach((locale) => {
    posts.forEach((post) => {
      paths.push({
        params: { slug: post.slug },
        locale,
      })
    })
  })

  return {
    paths,
    fallback: false,
  }
}

export async function getStaticProps({ params, locale }) {
  const post = await getPost(params.slug, locale)

  return {
    props: {
      post,
    },
  }
}
```

## With Base Path

```javascript
const nextConfig = {
  basePath: '/docs',
  i18n: {
    locales: ['en', 'fr'],
    defaultLocale: 'en',
  },
}
```

**URLs:**
- English: `/docs/about`
- French: `/docs/fr/about`

## SEO and i18n

### Language Links

```typescript
import Head from 'next/head'
import { useRouter } from 'next/router'

export default function Page() {
  const router = useRouter()
  const { locales, asPath } = router

  return (
    <>
      <Head>
        {locales?.map((locale) => (
          <link
            key={locale}
            rel="alternate"
            hrefLang={locale}
            href={`https://example.com${locale === 'en' ? '' : `/${locale}`}${asPath}`}
          />
        ))}
        <link
          rel="alternate"
          hrefLang="x-default"
          href={`https://example.com${asPath}`}
        />
      </Head>
      {/* Page content */}
    </>
  )
}
```

### Metadata per Locale

```typescript
import Head from 'next/head'
import { useRouter } from 'next/router'

const metadata = {
  en: {
    title: 'Welcome',
    description: 'Welcome to our site',
  },
  fr: {
    title: 'Bienvenue',
    description: 'Bienvenue sur notre site',
  },
}

export default function Page() {
  const { locale } = useRouter()
  const meta = metadata[locale]

  return (
    <>
      <Head>
        <title>{meta.title}</title>
        <meta name="description" content={meta.description} />
        <meta property="og:title" content={meta.title} />
        <meta property="og:description" content={meta.description} />
      </Head>
      {/* Page content */}
    </>
  )
}
```

## Complete Examples

### Full i18n Setup

```javascript
// next.config.js
const nextConfig = {
  i18n: {
    locales: ['en-US', 'fr-FR', 'de-DE', 'es-ES'],
    defaultLocale: 'en-US',
    localeDetection: true,
  },
}

module.exports = nextConfig
```

```typescript
// components/LocaleSwitcher.tsx
import { useRouter } from 'next/router'
import Link from 'next/link'

const languages = {
  'en-US': 'English',
  'fr-FR': 'Français',
  'de-DE': 'Deutsch',
  'es-ES': 'Español',
}

export default function LocaleSwitcher() {
  const router = useRouter()
  const { locales, locale: activeLocale } = router

  return (
    <div className="locale-switcher">
      {locales?.map((locale) => (
        <Link
          key={locale}
          href={router.asPath}
          locale={locale}
          className={locale === activeLocale ? 'active' : ''}
        >
          {languages[locale]}
        </Link>
      ))}
    </div>
  )
}
```

### Domain-Based Multi-Region

```javascript
// next.config.js
const nextConfig = {
  i18n: {
    locales: ['en-US', 'en-GB', 'fr-FR', 'fr-CA'],
    defaultLocale: 'en-US',

    domains: [
      {
        domain: 'example.com',
        defaultLocale: 'en-US',
        locales: ['en-US'],
      },
      {
        domain: 'example.co.uk',
        defaultLocale: 'en-GB',
        locales: ['en-GB'],
      },
      {
        domain: 'example.fr',
        defaultLocale: 'fr-FR',
        locales: ['fr-FR'],
      },
      {
        domain: 'example.ca',
        defaultLocale: 'en-CA',
        locales: ['en-CA', 'fr-CA'],
      },
    ],
  },
}
```

## App Router i18n

For App Router, use custom implementation or libraries:

### Using next-intl

```bash
npm install next-intl
```

```typescript
// app/[locale]/layout.tsx
import { NextIntlClientProvider } from 'next-intl'
import { notFound } from 'next/navigation'

export function generateStaticParams() {
  return [{ locale: 'en' }, { locale: 'fr' }, { locale: 'de' }]
}

export default async function LocaleLayout({
  children,
  params: { locale }
}: {
  children: React.ReactNode
  params: { locale: string }
}) {
  let messages
  try {
    messages = (await import(`../../messages/${locale}.json`)).default
  } catch (error) {
    notFound()
  }

  return (
    <html lang={locale}>
      <body>
        <NextIntlClientProvider locale={locale} messages={messages}>
          {children}
        </NextIntlClientProvider>
      </body>
    </html>
  )
}
```

### Custom App Router i18n

```typescript
// app/[lang]/page.tsx
import { getDictionary } from './dictionaries'

export default async function Page({
  params: { lang },
}: {
  params: { lang: string }
}) {
  const dict = await getDictionary(lang)

  return <div>{dict.welcome}</div>
}

export async function generateStaticParams() {
  return [{ lang: 'en' }, { lang: 'fr' }, { lang: 'de' }]
}
```

```typescript
// app/[lang]/dictionaries.ts
const dictionaries = {
  en: () => import('./dictionaries/en.json').then((module) => module.default),
  fr: () => import('./dictionaries/fr.json').then((module) => module.default),
  de: () => import('./dictionaries/de.json').then((module) => module.default),
}

export const getDictionary = async (locale: string) => {
  return dictionaries[locale]()
}
```

## Best Practices

1. **Use locale codes**: Follow BCP 47 (e.g., en-US, fr-FR)
2. **Set up alternate links**: Important for SEO
3. **Load translations efficiently**: Dynamic imports
4. **Use locale-aware formatting**: Dates, numbers, currency
5. **Test all locales**: Don't forget RTL languages
6. **Consider performance**: Don't load all translations upfront
7. **Document locale structure**: Help team understand setup

## Common Patterns

### Currency Formatting

```typescript
const formatCurrency = (amount: number, locale: string) => {
  return new Intl.NumberFormat(locale, {
    style: 'currency',
    currency: locale === 'en-US' ? 'USD' : locale === 'fr-FR' ? 'EUR' : 'GBP',
  }).format(amount)
}
```

### Date Formatting

```typescript
const formatDate = (date: Date, locale: string) => {
  return new Intl.DateTimeFormat(locale, {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
  }).format(date)
}
```

## Common Issues

### Locale Not Detected

Check `Accept-Language` header and cookie:

```typescript
// middleware.ts
export function middleware(request: NextRequest) {
  const locale = request.cookies.get('NEXT_LOCALE')?.value
  console.log('Detected locale:', locale)
}
```

### Redirects with i18n

```javascript
async redirects() {
  return [
    {
      source: '/old-page',
      destination: '/new-page',
      permanent: true,
      locale: false, // Apply to all locales
    },
  ]
}
```

### Static Export

i18n routing is not supported with `output: 'export'`. Use client-side routing or custom solution.
